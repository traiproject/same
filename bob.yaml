version: "1"
tasks:
  # Install dependencies
  install:
    input: ["go.mod", "go.sum"]
    cmd: ["go", "mod", "download"]

  # Format code
  fmt:
    input: ["cmd", "internal"]
    cmd: ["go", "fmt", "./..."]

  # Run linter
  lint:
    input: ["cmd", "internal"]
    cmd: ["golangci-lint", "run"]
    dependsOn: ["generate"]

  # Generate mocks
  generate:
    input:
      - "internal/engine/scheduler/scheduler.go"
      - "internal/app/wire.go"
    cmd: ["go", "generate", "./..."]
    target:
      - "internal/core/ports/mocks/"
      - "internal/app/wire_band.go"
    dependsOn: ["install"]

  # Run tests
  test:
    input: ["cmd", "internal"]
    cmd: ["go", "test", "-v", "-race", "./..."]
    dependsOn: ["generate", "lint"]

  # Build the binary
  build:
    input: ["cmd", "internal"]
    cmd: ["go", "build", "-o", "bin/bob", "./cmd/bob"]
    target: ["bin/bob"]
    dependsOn: ["test"]
