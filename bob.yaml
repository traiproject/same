version: "1"
tasks:
  # Install dependencies
  install:
    input: ["go.mod", "go.sum"]
    cmd: ["go", "mod", "download"]
    dependencies: ["go"]

  # Format code
  fmt:
    input: ["cmd", "internal"]
    cmd: ["go", "fmt", "./..."]
    dependencies: ["go"]

  # Run linter
  lint:
    input: ["cmd", "internal"]
    cmd: ["golangci-lint", "run"]
    dependsOn: ["generate"]
    dependencies: ["golangci-lint"]

  # Generate mocks
  generate:
    input: ["internal/engine/scheduler/scheduler.go"]
    cmd: ["go", "generate", "./..."]
    target: ["internal/core/ports/mocks/"]
    dependsOn: ["install"]
    dependencies: ["go"]

  # Run tests
  test:
    input: ["cmd", "internal"]
    cmd: ["go", "test", "-v", "-race", "./..."]
    dependsOn: ["generate", "lint"]
    dependencies: ["go"]

  # Build the binary
  build:
    input: ["cmd", "internal"]
    cmd: ["go", "build", "-o", "bin/bob", "./cmd/bob"]
    target: ["bin/bob"]
    dependsOn: ["test"]
    dependencies: ["go"]
