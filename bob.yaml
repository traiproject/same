version: "1"
tasks:
  # Install dependencies
  install:
    input: ["go.mod", "go.sum"]
    cmd: ["go", "mod", "download"]
    target: []

  # Format code
  fmt:
    input: ["cmd", "internal"]
    cmd: ["go", "fmt", "./..."]
    target: []

  # Run linter
  lint:
    input: ["cmd", "internal"]
    cmd: ["golangci-lint", "run"]
    target: []
    dependsOn: ["fmt"]

  # Generate mocks
  generate:
    input: ["internal/engine/scheduler/scheduler.go"]
    cmd: ["go", "generate", "./..."]
    target:
      - "internal/core/ports/mocks/mock_executor.go"
      - "internal/core/ports/mocks/mock_hasher.go"
      - "internal/core/ports/mocks/mock_logger.go"
      - "internal/core/ports/mocks/mock_store.go"
    dependsOn: ["install"]

  test:
    input: ["cmd", "internal"]
    cmd: ["go", "test", "-v", "./..."]
    target: []
    dependsOn: ["generate", "lint"]

  # Build the binary
  build:
    input: ["cmd", "internal"]
    cmd: ["go", "build", "-o", "bin/bob", "./cmd/bob"]
    target: ["bin/bob"]
    dependsOn: ["test"]
