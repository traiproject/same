version: "1"
project: cli
tasks:
  # Install dependencies
  install:
    input: ["go.mod", "go.sum"]
    cmd: ["go", "mod", "download"]
    tools: ["go"]

  # Format code
  fmt:
    input: ["cmd", "internal"]
    cmd: ["go", "fmt", "./..."]
    tools: ["go"]

  # Run linter
  lint:
    input: ["cmd", "internal"]
    cmd: ["golangci-lint", "run"]
    tools: ["lint"]
    dependsOn: ["generate"]

  # Generate mocks
  generate:
    input:
      - "internal/core/ports/*.go"
    cmd: ["go", "generate", "./..."]
    target:
      - "internal/core/ports/mocks/"
    tools: ["go"]
    dependsOn: ["install"]

  # Run tests
  test:
    input: ["cmd", "internal"]
    cmd: ["go", "test", "-v", "-race", "./..."]
    tools: ["go"]
    dependsOn: ["generate"]

  # Build the binary
  build:
    input: ["cmd", "internal"]
    cmd: ["go", "build", "-o", "bin/same", "./cmd/same"]
    target: ["bin/same"]
    tools: ["go"]
    dependsOn: ["test"]
