version: "1"
project: cli
tasks:
  # Install dependencies
  install:
    input: ["go.mod", "go.sum"]
    cmd: ["go", "mod", "download"]
    tools: ["go"]

  # Run linter
  lint:
    input: ["cmd", "internal"]
    cmd: ["golangci-lint", "run", "--config", "../.golangci.yaml", "./..."]
    tools: ["lint"]
    dependsOn: ["generate"]

  # Generate mocks
  generate:
    input:
      - "internal/core/ports/*.go"
    cmd: ["go", "generate", "./..."]
    target:
      - "internal/core/ports/mocks/"
    tools: ["go"]
    dependsOn: ["install"]

  # Run tests
  test:
    input: ["cmd", "internal"]
    cmd: ["go", "test", "-v", "-race", "./..."]
    tools: ["go"]
    dependsOn: ["generate"]

  # Build the binary
  build:
    input: ["cmd", "internal"]
    cmd: ["go", "build", "-o", "bin/same", "./cmd/same"]
    target: ["bin/same"]
    tools: ["go"]
    dependsOn: ["generate"]

  # Run E2E tests
  e2e-test:
    input: ["e2e", "cmd", "internal"]
    cmd: ["go", "test", "-v", "-tags=e2e", "./e2e/..."]
    tools: ["go"]
    dependsOn: ["generate"]
